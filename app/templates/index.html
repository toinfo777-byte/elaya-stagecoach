<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Элайя — StageCoach · HQ Panel</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="/static/css/theme.css">
  <style>
    /* Небольшая «подложка», чтобы страница показалась раньше */
    body{opacity:1;transition:opacity .2s ease}
  </style>
</head>
<body>
  <div class="hq-container">

    <h1 class="hq-title">
      Элайя — StageCoach
      <span class="sun pulse" aria-hidden="true"></span>
    </h1>
    <p class="hq-subtitle">панель наблюдения</p>

    <section class="hq-panel">
      <div class="stripe"></div>

      <div class="hq-grid">
        <!-- ПОРТАЛ -->
        <div class="card">
          <h3>Портал</h3>
          <div class="pills">
            <span class="pill pill--intro">Stable</span>
            <span class="pill pill--reflect">Online</span>
            <span class="pill pill--transition">Light active</span>
          </div>

          <hr class="sep">

          <div class="small hq-breadcrumbs">
            <span class="badge dim"><span class="dot"></span> HQ Panel</span>
            <span class="badge ok"><span class="dot"></span> Cycle Active</span>
            <span class="badge dim"><span class="dot"></span> Memory Stable</span>
            <span class="badge dim"><span class="dot"></span> Reflection On</span>
          </div>
        </div>

        <!-- ПРИВЕТСТВИЕ -->
        <div class="card reflect-box">
          <h3>Привет! Панель Элай запущена.</h3>
          <div class="reflect-text" id="reflect_text">—</div>
          <div class="reflect-footer">
            <span id="reflect_time">версия 1.2</span>
            <span class="moon pulse" title="Свет"></span>
          </div>
        </div>
      </div>

      <!-- CORE · СЧЁТЧИКИ -->
      <div class="card" style="margin: 12px 26px 6px;">
        <h3>Core · состояние</h3>
        <div class="small" id="core_updated">Последнее обновление: —</div>
        <div class="pills" style="margin-top:12px">
          <span class="pill pill--intro">intro: <b id="stat_intro">0</b></span>
          <span class="pill pill--reflect">reflect: <b id="stat_reflect">0</b></span>
          <span class="pill pill--transition">transition: <b id="stat_transition">0</b></span>
        </div>
      </div>

      <div class="hq-status">
        <span class="badge dim"><span class="dot"></span> HQ Panel</span>
        <span class="badge ok"><span class="dot"></span> Cycle Active</span>
        <span class="badge dim"><span class="dot"></span> Memory Stable</span>
        <span class="badge dim"><span class="dot"></span> Reflection On</span>
      </div>
    </section>
  </div>

  <script>
    async function loadStats(){
      try{
        const r = await fetch('/ui/stats.json', {cache:'no-store'});
        const j = await r.json();
        const c = j.core || {};
        const refl = j.reflection || {};
        // числа
        document.getElementById('stat_intro').textContent = c.intro ?? 0;
        document.getElementById('stat_reflect').textContent = c.reflect ?? 0;
        document.getElementById('stat_transition').textContent = c.transition ?? 0;
        // время
        document.getElementById('core_updated').textContent =
          'Последнее обновление: ' + (c.last_updated || '—');
        // последняя заметка
        document.getElementById('reflect_text').textContent =
          refl.text ? String(refl.text) : '—';
        document.getElementById('reflect_time').textContent =
          refl.updated_at ? refl.updated_at : 'версия 1.2';
      }catch(e){
        console.warn('stats.json error', e);
      }
    }
    loadStats();
    setInterval(loadStats, 10_000);
  </script>
</body>
</html>
