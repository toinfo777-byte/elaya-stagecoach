from __future__ import annotations

from aiogram import Router
from aiogram.filters import Command, CommandStart
from aiogram.types import (
    Message, CallbackQuery,
    InlineKeyboardMarkup, InlineKeyboardButton,
)

help_router = Router(name="help")

def _menu_kb() -> InlineKeyboardMarkup:
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="ğŸ‹ï¸ Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ´Ğ½Ñ",    callback_data="go:training")],
        [InlineKeyboardButton(text="ğŸ­ ĞœĞ¸Ğ½Ğ¸-ĞºĞ°ÑÑ‚Ğ¸Ğ½Ğ³",      callback_data="go:casting")],
        [InlineKeyboardButton(text="ğŸ§­ ĞŸÑƒÑ‚ÑŒ Ğ»Ğ¸Ğ´ĞµÑ€Ğ°",       callback_data="go:leader")],
        [InlineKeyboardButton(text="ğŸ“ˆ ĞœĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ",      callback_data="go:progress")],
        [InlineKeyboardButton(text="ğŸ’¬ ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ / FAQ",      callback_data="go:help")],
        [InlineKeyboardButton(text="ğŸ” ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°",          callback_data="go:privacy")],
        [InlineKeyboardButton(text="âš™ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸",         callback_data="go:settings")],
        [InlineKeyboardButton(text="â­ Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ", callback_data="go:extended")],
    ])

async def _reply(obj: Message | CallbackQuery, text: str,
                 kb: InlineKeyboardMarkup | None = None):
    if isinstance(obj, CallbackQuery):
        await obj.answer()
        return await obj.message.answer(text, reply_markup=kb)
    return await obj.answer(text, reply_markup=kb)

async def show_main_menu(obj: Message | CallbackQuery):
    text = (
        "ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¸ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ñ‹: Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğµ â¤µï¸\n\n"
        "ğŸ‹ï¸ <b>Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ´Ğ½Ñ</b> â€” ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ°Ñ Ñ€ÑƒÑ‚Ğ¸Ğ½Ğ° 5â€“15 Ğ¼Ğ¸Ğ½.\n"
        "ğŸ­ <b>ĞœĞ¸Ğ½Ğ¸-ĞºĞ°ÑÑ‚Ğ¸Ğ½Ğ³</b> â€” Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ñ‡ĞµĞº 2â€“3 Ğ¼Ğ¸Ğ½.\n"
        "ğŸ§­ <b>ĞŸÑƒÑ‚ÑŒ Ğ»Ğ¸Ğ´ĞµÑ€Ğ°</b> â€” Ñ†ĞµĞ»ÑŒ + Ğ¼Ğ¸ĞºÑ€Ğ¾-Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ + Ğ·Ğ°ÑĞ²ĞºĞ°.\n"
        "ğŸ“ˆ <b>ĞœĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ</b> â€” ÑÑ‚Ñ€Ğ¸Ğº Ğ¸ ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´Ñ‹ Ğ·Ğ° 7 Ğ´Ğ½ĞµĞ¹.\n"
        "ğŸ’¬ <b>ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ / FAQ</b> â€” Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° Ñ‡Ğ°ÑÑ‚Ñ‹Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹.\n"
        "âš™ï¸ <b>ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸</b> â€” Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ.\n"
        "ğŸ” <b>ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°</b> â€” ĞºĞ°Ğº Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ¼ Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ.\n"
        "â­ <b>Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ</b> â€” ÑĞºĞ¾Ñ€Ğ¾."
    )
    await _reply(obj, text, _menu_kb())

async def show_help(obj: Message | CallbackQuery):
    text = (
        "ğŸ’¬ <b>ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ / FAQ</b>\n\n"
        "â€” ĞĞ°Ğ¶Ğ¼Ğ¸ Â«ğŸ‹ï¸ Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ´Ğ½ÑÂ», Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ.\n"
        "â€” Â«ğŸ“ˆ ĞœĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑÂ» Ğ¿Ğ¾ĞºĞ°Ğ¶ĞµÑ‚ ÑÑ‚Ñ€Ğ¸Ğº Ğ¸ ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´Ñ‹.\n"
        "â€” Â«ğŸ§­ ĞŸÑƒÑ‚ÑŒ Ğ»Ğ¸Ğ´ĞµÑ€Ğ°Â» â€” Ğ·Ğ°ÑĞ²ĞºĞ° Ğ¸ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑˆĞ°Ğ³.\n\n"
        "Ğ•ÑĞ»Ğ¸ Ñ‡Ñ‚Ğ¾-Ñ‚Ğ¾ Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ â€” /ping."
    )
    await _reply(obj, text, _menu_kb())

async def show_privacy(obj: Message | CallbackQuery):
    await _reply(obj, "ğŸ” <b>ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°</b>\n\nĞ”ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ğ¼ Ğ¿ĞµÑ€ĞµĞ´ Ñ€ĞµĞ»Ğ¸Ğ·Ğ¾Ğ¼.", _menu_kb())

async def show_settings(obj: Message | CallbackQuery):
    await _reply(obj, "âš™ï¸ <b>ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸</b>\n\nĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ² Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ.", _menu_kb())

@help_router.message(CommandStart(deep_link=False))
async def start_no_payload(m: Message):
    await show_main_menu(m)

@help_router.message(Command("menu"))
async def cmd_menu(m: Message):
    await show_main_menu(m)

@help_router.message(Command("help"))
async def cmd_help(m: Message):
    await show_help(m)

@help_router.callback_query(lambda cq: cq.data == "go:help")
async def cb_help(cq: CallbackQuery):
    await show_help(cq)
