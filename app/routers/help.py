from __future__ import annotations

from aiogram import Router
from aiogram.filters import Command, CommandStart
from aiogram.types import (
    Message, CallbackQuery,
    InlineKeyboardMarkup, InlineKeyboardButton, ReplyKeyboardRemove,
)

help_router = Router(name="help")


def _menu_kb() -> InlineKeyboardMarkup:
    # 8 –∫–Ω–æ–ø–æ–∫, –≤–∫–ª—é—á–∞—è üí¨ –∏ ‚≠ê
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üèãÔ∏è –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –¥–Ω—è",    callback_data="go:training")],
        [InlineKeyboardButton(text="üé≠ –ú–∏–Ω–∏-–∫–∞—Å—Ç–∏–Ω–≥",      callback_data="go:casting")],
        [InlineKeyboardButton(text="üß≠ –ü—É—Ç—å –ª–∏–¥–µ—Ä–∞",       callback_data="go:leader")],
        [InlineKeyboardButton(text="üìà –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å",      callback_data="go:progress")],
        [InlineKeyboardButton(text="üí¨ –ü–æ–º–æ—â—å / FAQ",      callback_data="go:help")],
        [InlineKeyboardButton(text="üîê –ü–æ–ª–∏—Ç–∏–∫–∞",          callback_data="go:privacy")],
        [InlineKeyboardButton(text="‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏",         callback_data="go:settings")],
        [InlineKeyboardButton(text="‚≠ê –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è", callback_data="go:extended")],
    ])


async def _clear_reply_kb(obj: Message | CallbackQuery):
    """
    –ù–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –≥–¥–µ-—Ç–æ –æ—Å—Ç–∞–ª–∞—Å—å ReplyKeyboard ‚Äî –≥–∞—Å–∏–º –µ—ë –Ω–µ–≤–∏–¥–∏–º—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.
    –ò–Ω–∞—á–µ inline-–∫–Ω–æ–ø–∫–∏ –º–æ–≥—É—Ç ¬´–º–æ–ª—á–∞—Ç—å¬ª –∏–∑-–∑–∞ —Å–º–µ—à–∞–Ω–Ω—ã—Ö —Ä–∞–∑–º–µ—Ç–æ–∫.
    """
    if isinstance(obj, CallbackQuery):
        await obj.message.answer("\u2063", reply_markup=ReplyKeyboardRemove())
    else:
        await obj.answer("\u2063", reply_markup=ReplyKeyboardRemove())


async def _reply(obj: Message | CallbackQuery, text: str,
                 kb: InlineKeyboardMarkup | None = None):
    if isinstance(obj, CallbackQuery):
        await obj.answer()
        # —Å–Ω–∞—á–∞–ª–∞ —É–±–∏—Ä–∞–µ–º reply-–∫–ª–∞–≤—É, –ø–æ—Ç–æ–º ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω
        await _clear_reply_kb(obj)
        return await obj.message.answer(text, reply_markup=kb)
    await _clear_reply_kb(obj)
    return await obj.answer(text, reply_markup=kb)


# ‚Äî‚Äî‚Äî –ü—É–±–ª–∏—á–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã ‚Äî‚Äî‚Äî
async def show_main_menu(obj: Message | CallbackQuery):
    text = (
        "–ö–æ–º–∞–Ω–¥—ã –∏ —Ä–∞–∑–¥–µ–ª—ã: –≤—ã–±–µ—Ä–∏ –Ω—É–∂–Ω–æ–µ ‚§µÔ∏è\n\n"
        "üèãÔ∏è <b>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –¥–Ω—è</b> ‚Äî –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä—É—Ç–∏–Ω–∞ 5‚Äì15 –º–∏–Ω.\n"
        "üé≠ <b>–ú–∏–Ω–∏-–∫–∞—Å—Ç–∏–Ω–≥</b> ‚Äî –±—ã—Å—Ç—Ä—ã–π —á–µ–∫ 2‚Äì3 –º–∏–Ω.\n"
        "üß≠ <b>–ü—É—Ç—å –ª–∏–¥–µ—Ä–∞</b> ‚Äî —Ü–µ–ª—å + –º–∏–∫—Ä–æ-–∑–∞–¥–∞–Ω–∏–µ + –∑–∞—è–≤–∫–∞.\n"
        "üìà <b>–ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</b> ‚Äî —Å—Ç—Ä–∏–∫ –∏ —ç–ø–∏–∑–æ–¥—ã –∑–∞ 7 –¥–Ω–µ–π.\n"
        "üí¨ <b>–ü–æ–º–æ—â—å / FAQ</b> ‚Äî –æ—Ç–≤–µ—Ç—ã –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã.\n"
        "‚öôÔ∏è <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b> ‚Äî –ø—Ä–æ—Ñ–∏–ª—å.\n"
        "üîê <b>–ü–æ–ª–∏—Ç–∏–∫–∞</b> ‚Äî –∫–∞–∫ —Ö—Ä–∞–Ω–∏–º –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ.\n"
        "‚≠ê <b>–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</b> ‚Äî —Å–∫–æ—Ä–æ."
    )
    await _reply(obj, text, _menu_kb())


async def show_help(obj: Message | CallbackQuery):
    text = (
        "üí¨ <b>–ü–æ–º–æ—â—å / FAQ</b>\n\n"
        "‚Äî –ù–∞–∂–º–∏ ¬´üèãÔ∏è –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –¥–Ω—è¬ª, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.\n"
        "‚Äî ¬´üìà –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å¬ª –ø–æ–∫–∞–∂–µ—Ç —Å—Ç—Ä–∏–∫ –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —ç–ø–∏–∑–æ–¥—ã.\n"
        "‚Äî ¬´üß≠ –ü—É—Ç—å –ª–∏–¥–µ—Ä–∞¬ª ‚Äî –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ –∏ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥.\n\n"
        "–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî /ping"
    )
    await _reply(obj, text, _menu_kb())


async def show_privacy(obj: Message | CallbackQuery):
    text = (
        "üîê <b>–ü–æ–ª–∏—Ç–∏–∫–∞</b>\n\n"
        "–•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.\n"
        "–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –¥–æ–ø–æ–ª–Ω–∏–º –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º prod."
    )
    await _reply(obj, text, _menu_kb())


async def show_settings(obj: Message | CallbackQuery):
    text = (
        "‚öôÔ∏è <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b>\n\n"
        "–ü—Ä–æ—Ñ–∏–ª—å –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è ‚Äî –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ –º–µ–Ω—é."
    )
    await _reply(obj, text, _menu_kb())


# ‚Äî‚Äî‚Äî –ö–æ–º–∞–Ω–¥–Ω—ã–µ –≤—Ö–æ–¥—ã ‚Äî‚Äî‚Äî
@help_router.message(CommandStart(deep_link=False))
async def start_no_payload(m: Message):
    await show_main_menu(m)


@help_router.message(Command("menu"))
async def cmd_menu(m: Message):
    await show_main_menu(m)


@help_router.message(Command("help"))
async def cmd_help(m: Message):
    await show_help(m)


@help_router.callback_query(lambda cq: cq.data == "go:help")
async def cb_help(cq: CallbackQuery):
    await show_help(cq)
