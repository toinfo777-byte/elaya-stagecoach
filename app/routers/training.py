# app/routers/training.py
from __future__ import annotations

from aiogram import Router, F
from aiogram.filters import Command, StateFilter
from aiogram.fsm.context import FSMContext
from aiogram.types import Message, CallbackQuery
from aiogram.utils.keyboard import InlineKeyboardBuilder

from app.keyboards.reply import main_menu_kb, BTN_TRAINING

router = Router(name="training")

# â”€â”€ ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def kb_training_levels():
    kb = InlineKeyboardBuilder()
    kb.button(text="Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 1 Â· 5 Ğ¼Ğ¸Ğ½",  callback_data="tr:l1")
    kb.button(text="Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 2 Â· 10 Ğ¼Ğ¸Ğ½", callback_data="tr:l2")
    kb.button(text="Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 3 Â· 15 Ğ¼Ğ¸Ğ½", callback_data="tr:l3")
    kb.button(text="âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ğ»(Ğ°)",     callback_data="tr:done")
    kb.button(text="ğŸ  Ğ’ Ğ¼ĞµĞ½Ñ",          callback_data="go:menu")
    kb.adjust(1, 1, 1, 1, 1)
    return kb.as_markup()

def kb_done_menu():
    kb = InlineKeyboardBuilder()
    kb.button(text="âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ğ»(Ğ°)", callback_data="tr:done")
    kb.button(text="ğŸ  Ğ’ Ğ¼ĞµĞ½Ñ",      callback_data="go:menu")
    kb.adjust(1, 1)
    return kb.as_markup()

# â”€â”€ ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PLAN_HEADERS = {
    "l1": (
        "ĞĞ¾Ğ²Ğ¸Ñ‡Ğ¾Ğº Â· 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚\n"
        "1) Ğ”Ñ‹Ñ…Ğ°Ğ½Ğ¸Ğµ â€” 1 Ğ¼Ğ¸Ğ½\n"
        "2) Ğ Ğ¾Ñ‚-ÑĞ·Ñ‹Ğº-Ñ‰ĞµĞ»Ñ‡ĞºĞ¸ â€” 2 Ğ¼Ğ¸Ğ½\n"
        "3) ĞÑ€Ñ‚Ğ¸ĞºÑƒĞ»ÑÑ†Ğ¸Ñ â€” 2 Ğ¼Ğ¸Ğ½\n\n"
        "ĞĞ¸Ğ¶Ğµ â€” Ğ¿Ğ¾ÑÑĞ½ĞµĞ½Ğ¸Ñ ğŸ‘‡"
    ),
    "l2": (
        "Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Â· 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚\n"
        "1) Ğ”Ñ‹Ñ…Ğ°Ğ½Ğ¸Ğµ Ñ Ğ¾Ğ¿Ğ¾Ñ€Ğ¾Ğ¹ â€” 3 Ğ¼Ğ¸Ğ½\n"
        "2) Ğ ĞµĞ·Ğ¾Ğ½Ğ°Ñ‚Ğ¾Ñ€Ñ‹ (Ğ¼-Ğ½-Ğ·) â€” 3 Ğ¼Ğ¸Ğ½\n"
        "3) Ğ¢ĞµĞºÑÑ‚-Ñ€Ğ¸Ñ‚Ğ¼ â€” 4 Ğ¼Ğ¸Ğ½\n\n"
        "ĞĞ¸Ğ¶Ğµ â€” Ğ¿Ğ¾ÑÑĞ½ĞµĞ½Ğ¸Ñ ğŸ‘‡"
    ),
    "l3": (
        "ĞŸÑ€Ğ¾ Â· 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚\n"
        "1) Ğ ĞµĞ·Ğ¾Ğ½Ğ°Ñ‚Ğ¾Ñ€Ñ‹ â€” 5 Ğ¼Ğ¸Ğ½\n"
        "2) Ğ¢ĞµĞºÑÑ‚ Ñ Ğ¿Ğ°ÑƒĞ·Ğ°Ğ¼Ğ¸ â€” 5 Ğ¼Ğ¸Ğ½\n"
        "3) ĞœĞ¸ĞºÑ€Ğ¾-ÑÑ‚ÑĞ´ â€” 5 Ğ¼Ğ¸Ğ½\n\n"
        "ĞĞ¸Ğ¶Ğµ â€” Ğ¿Ğ¾ÑÑĞ½ĞµĞ½Ğ¸Ñ ğŸ‘‡"
    ),
}

DETAILS_L1 = (
    "Ğ”Ñ‹Ñ…Ğ°Ğ½Ğ¸Ğµ â€” 1 Ğ¼Ğ¸Ğ½\n"
    "â€¢ Ğ’Ğ´Ğ¾Ñ… Ğ½Ğ° 4 â€” Ğ¿Ğ°ÑƒĞ·Ğ° 2 â€” Ğ²Ñ‹Ğ´Ğ¾Ñ… Ğ½Ğ° 6 Ñ‡ĞµÑ€ĞµĞ· Â«ÑÂ». ĞŸĞ»ĞµÑ‡Ğ¸ Ñ€Ğ°ÑÑĞ»Ğ°Ğ±Ğ»ĞµĞ½Ñ‹.\n\n"
    "Ğ Ğ¾Ñ‚-ÑĞ·Ñ‹Ğº-Ñ‰ĞµĞ»Ñ‡ĞºĞ¸ â€” 2 Ğ¼Ğ¸Ğ½\n"
    "â€¢ Â«Ğ¢Ñ€ĞµĞ»ÑŒÂ» Ğ³ÑƒĞ±Ğ°Ğ¼Ğ¸/ÑĞ·Ñ‹ĞºĞ¾Ğ¼ Ğ¿Ğ¾ 20â€“30 ÑĞµĞº; 10 Ñ‡Ñ‘Ñ‚ĞºĞ¸Ñ… Ñ‰ĞµĞ»Ñ‡ĞºĞ¾Ğ² ÑĞ·Ñ‹ĞºĞ¾Ğ¼.\n\n"
    "ĞÑ€Ñ‚Ğ¸ĞºÑƒĞ»ÑÑ†Ğ¸Ñ â€” 2 Ğ¼Ğ¸Ğ½\n"
    "â€¢ ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ â†’ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾: Â«Ğ¨Ğ»Ğ° Ğ¡Ğ°ÑˆĞ° Ğ¿Ğ¾ ÑˆĞ¾ÑÑĞµâ€¦Â». Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ¿Ğ°ÑƒĞ·Ñ‹ (|) Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ¼Ñ‹ÑĞ»Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ ĞºÑƒÑĞºĞ°Ğ¼Ğ¸.\n\n"
    "ĞšĞ¾Ğ³Ğ´Ğ° Ğ·Ğ°ĞºĞ¾Ğ½Ñ‡Ğ¸ÑˆÑŒ â€” Ğ¶Ğ¼Ğ¸ âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ğ»(Ğ°). Ğ¥Ğ¾Ñ‡ĞµÑˆÑŒ Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ â€” ğŸ  Ğ’ Ğ¼ĞµĞ½Ñ."
)

DETAILS_L2 = (
    "Ğ”Ñ‹Ñ…Ğ°Ğ½Ğ¸Ğµ Ñ Ğ¾Ğ¿Ğ¾Ñ€Ğ¾Ğ¹ â€” 3 Ğ¼Ğ¸Ğ½\n"
    "â€¢ Ğ’Ğ´Ğ¾Ñ… Ğ²Ğ½Ğ¸Ğ· Ğ² Ğ±Ğ¾ĞºĞ°, Ğ²Ñ‹Ğ´Ğ¾Ñ… Ğ½Ğ° Â«Ñ„/ÑÂ», Ğ´ĞµÑ€Ğ¶Ğ¸ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ Ğ´Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ²ÑƒĞºĞ°.\n\n"
    "Ğ ĞµĞ·Ğ¾Ğ½Ğ°Ñ‚Ğ¾Ñ€Ñ‹ (Ğ¼-Ğ½-Ğ·) â€” 3 Ğ¼Ğ¸Ğ½\n"
    "â€¢ Ğ“ÑƒĞ´Ğ¸Ğ¼ Â«Ğ¼Â» Ğ½Ğ° 3â€“5 Ğ½Ğ¾Ñ‚ Ğ¿Ğ¾ Ğ³Ğ°Ğ¼Ğ¼Ğµ, Ğ¾Ñ‰ÑƒÑ‰Ğ°ĞµĞ¼ Ğ²Ğ¸Ğ±Ñ€Ğ°Ñ†Ğ¸Ñ Ğ² Ğ³ÑƒĞ±Ğ°Ñ…/Ğ½Ğ¾ÑĞµ/ÑĞºÑƒĞ»Ğµ.\n\n"
    "Ğ¢ĞµĞºÑÑ‚-Ñ€Ğ¸Ñ‚Ğ¼ â€” 4 Ğ¼Ğ¸Ğ½\n"
    "â€¢ ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ¹ Ğ°Ğ±Ğ·Ğ°Ñ†: Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ· Ñ€Ğ¾Ğ²Ğ½Ğ¾, Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ â€” Ñ Ğ¿Ğ°ÑƒĞ·Ğ°Ğ¼Ğ¸ Â«3-2-1Â», Ñ‚Ñ€ĞµÑ‚Ğ¸Ğ¹ â€” Ñ Ğ°ĞºÑ†ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸ Ğ½Ğ° ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ° (ĞšĞĞŸĞ¡/Ğ¶ĞµÑÑ‚).\n\n"
    "ĞšĞ¾Ğ³Ğ´Ğ° Ğ·Ğ°ĞºĞ¾Ğ½Ñ‡Ğ¸ÑˆÑŒ â€” Ğ¶Ğ¼Ğ¸ âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ğ»(Ğ°). Ğ¥Ğ¾Ñ‡ĞµÑˆÑŒ Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ â€” ğŸ  Ğ’ Ğ¼ĞµĞ½Ñ."
)

DETAILS_L3 = (
    "Ğ ĞµĞ·Ğ¾Ğ½Ğ°Ñ‚Ğ¾Ñ€Ñ‹ â€” 5 Ğ¼Ğ¸Ğ½\n"
    "â€¢ Â«Ğ¼-Ğ½-Ğ½Ğ³Â» Ğ¿Ğ¾ Ğ½Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰ĞµĞ¹, Ğ¸Ñ‰ĞµĞ¼ Ğ¿Ğ¾Ğ»Ñ‘Ñ‚ Ğ±ĞµĞ· Ñ„Ğ¾Ñ€ÑĞ°Ğ¶Ğ°.\n"
    "â€¢ 3 ÑĞµÑ€Ğ¸Ğ¸ Â«Ğ±Ğ¸-Ğ±Ğµ-Ğ±Ğ°-Ğ±Ğ¾-Ğ±ÑƒÂ» Ğ½Ğ° Ğ»Ñ‘Ğ³ĞºĞ¾Ğ¹ Ğ¾Ğ¿Ğ¾Ñ€Ğµ, Ğ½Ğµ Ğ·Ğ°Ğ»Ğ¸Ğ¿Ğ°ĞµĞ¼ Ğ² Ğ³Ğ¾Ñ€Ğ»Ğµ.\n\n"
    "Ğ¢ĞµĞºÑÑ‚ Ñ Ğ¿Ğ°ÑƒĞ·Ğ°Ğ¼Ğ¸ â€” 5 Ğ¼Ğ¸Ğ½\n"
    "â€¢ Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ 6â€“8 Ñ„Ñ€Ğ°Ğ·. Ğ¡Ñ…ĞµĞ¼Ğ° Ğ¿Ğ°ÑƒĞ·: 2|1|3|1|2|3 (Ğ² ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ…).\n"
    "â€¢ ĞœĞ°Ñ€ĞºĞµÑ€Ğ¾Ğ¼ Ğ²Ñ‹Ğ´ĞµĞ»Ğ¸ ÑĞ¼Ñ‹ÑĞ», Ğ½Ğ° Ğ¿Ğ°ÑƒĞ·Ğµ â€” Ğ²Ğ·Ğ³Ğ»ÑĞ´ Ğ² Ñ‚Ğ¾Ñ‡ĞºÑƒ/Ğ¶ĞµÑÑ‚.\n\n"
    "ĞœĞ¸ĞºÑ€Ğ¾-ÑÑ‚ÑĞ´ â€” 5 Ğ¼Ğ¸Ğ½\n"
    "â€¢ Ğ¢ĞµĞ·Ğ¸Ñ (1 Ñ„Ñ€Ğ°Ğ·Ğ°) â†’ Ğ¼Ğ¸Ğ½Ğ¸-Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ (20â€“30 ÑĞµĞº) â†’ Ğ²Ñ‹Ğ²Ğ¾Ğ´ (1 Ñ„Ñ€Ğ°Ğ·Ğ°).\n"
    "â€¢ Ğ¡Ğ½Ğ¸Ğ¼Ğ¸ Ğ½Ğ° Ğ²Ğ¸Ğ´ĞµĞ¾ 30â€“45 ÑĞµĞº. ĞÑ†ĞµĞ½Ğ¸: Ñ‚ĞµĞ¼Ğ¿, Ğ¿Ğ°ÑƒĞ·Ñ‹, Ğ°ĞºÑ†ĞµĞ½Ñ‚Ñ‹.\n\n"
    "ĞšĞ¾Ğ³Ğ´Ğ° Ğ·Ğ°ĞºĞ¾Ğ½Ñ‡Ğ¸ÑˆÑŒ â€” Ğ¶Ğ¼Ğ¸ âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ğ»(Ğ°). Ğ¥Ğ¾Ñ‡ĞµÑˆÑŒ Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ â€” ğŸ  Ğ’ Ğ¼ĞµĞ½Ñ."
)

DETAILS = {"l1": DETAILS_L1, "l2": DETAILS_L2, "l3": DETAILS_L3}

# â”€â”€ ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ²Ñ…Ğ¾Ğ´Ñ‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async def training_start(msg: Message, state: FSMContext | None = None) -> None:
    if state is not None:
        await state.clear()
    await msg.answer(
        "ğŸ‹ï¸ Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ´Ğ½Ñ\n\nĞ’Ñ‹Ğ±ĞµÑ€Ğ¸ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ. ĞŸĞ¾ÑĞ»Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ½Ğ°Ğ¶Ğ¼Ğ¸ Â«âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ğ»(Ğ°)Â».",
        reply_markup=kb_training_levels(),
    )

async def show_training_levels(message: Message, state: FSMContext) -> None:
    await training_start(message, state)

# Ğ°Ğ»Ğ¸Ğ°ÑÑ‹ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
training_entry = show_training_levels

# â”€â”€ ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹/ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ²Ñ…Ğ¾Ğ´Ğ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@router.message(StateFilter("*"), Command("training"))
async def cmd_training(msg: Message, state: FSMContext):
    await training_start(msg, state)

@router.message(StateFilter("*"), F.text == BTN_TRAINING)
async def btn_training(msg: Message, state: FSMContext):
    await training_start(msg, state)

@router.callback_query(StateFilter("*"), F.data == "go:training")
async def go_training(cb: CallbackQuery, state: FSMContext):
    await cb.answer()
    await training_start(cb.message, state)

# â”€â”€ ĞŸĞ»Ğ°Ğ½Ñ‹ Ğ¸ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@router.callback_query(F.data.in_({"tr:l1", "tr:l2", "tr:l3"}))
async def show_plan(cb: CallbackQuery):
    await cb.answer()
    key = cb.data.split(":")[1]
    await cb.message.answer(PLAN_HEADERS[key])
    await cb.message.answer(DETAILS[key], reply_markup=kb_done_menu())

@router.callback_query(F.data == "tr:done")
async def training_done(cb: CallbackQuery, state: FSMContext):
    await cb.answer()
    # TODO: Ğ¸Ğ½ĞºÑ€ĞµĞ¼ĞµĞ½Ñ‚ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°/ÑÑ‚Ñ€Ğ¸ĞºĞ° Ğ² Ğ‘Ğ” (Ğ¿Ğ¾ Ğ¶ĞµĞ»Ğ°Ğ½Ğ¸Ñ)
    await cb.message.answer("ğŸ”¥ ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! Ğ”ĞµĞ½ÑŒ Ğ·Ğ°ÑÑ‡Ğ¸Ñ‚Ğ°Ğ½. Ğ£Ğ²Ğ¸Ğ´Ğ¸Ğ¼ÑÑ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°!")
    await state.clear()
    await cb.message.answer("Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾! ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°Ñ Ğ¼ĞµĞ½Ñ.", reply_markup=main_menu_kb())

__all__ = ["router", "show_training_levels", "training_entry", "training_start"]
