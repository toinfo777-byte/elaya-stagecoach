from __future__ import annotations

from aiogram import Router, F
from aiogram.fsm.context import FSMContext
from aiogram.types import Message, CallbackQuery, InlineKeyboardMarkup, InlineKeyboardButton

# ĞµÑĞ»Ğ¸ router ÑƒĞ¶Ğµ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½ â€” Ğ½Ğµ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒĞµĞ¼
try:
    router  # noqa: F821
except NameError:
    router = Router(name="training")

# â”€â”€ Ñ‚ĞµĞºÑÑ‚Ñ‹ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
LEVEL1_TEXT = (
    "Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 1 Â· 5 Ğ¼Ğ¸Ğ½\n\n"
    "Ğ”Ñ‹Ñ…Ğ°Ğ½Ğ¸Ğµ â€” 1 Ğ¼Ğ¸Ğ½\n"
    "â€¢ Ğ’Ğ´Ğ¾Ñ… Ğ½Ğ° 4 â€” Ğ¿Ğ°ÑƒĞ·Ğ° 2 â€” Ğ²Ñ‹Ğ´Ğ¾Ñ… Ğ½Ğ° 6 Ñ‡ĞµÑ€ĞµĞ· Â«ÑÂ». ĞŸĞ»ĞµÑ‡Ğ¸ Ñ€Ğ°ÑÑĞ»Ğ°Ğ±Ğ»ĞµĞ½Ñ‹.\n\n"
    "Ğ Ğ¾Ñ‚-ÑĞ·Ñ‹Ğº-Ñ‰ĞµĞ»Ñ‡ĞºĞ¸ â€” 2 Ğ¼Ğ¸Ğ½\n"
    "â€¢ Â«Ğ¢Ñ€ĞµĞ»ÑŒÂ» Ğ³ÑƒĞ±Ğ°Ğ¼Ğ¸/ÑĞ·Ñ‹ĞºĞ¾Ğ¼ Ğ¿Ğ¾ 20â€“30 ÑĞµĞº; 10 Ñ‡Ñ‘Ñ‚ĞºĞ¸Ñ… Ñ‰ĞµĞ»Ñ‡ĞºĞ¾Ğ² ÑĞ·Ñ‹ĞºĞ¾Ğ¼.\n\n"
    "ĞÑ€Ñ‚Ğ¸ĞºÑƒĞ»ÑÑ†Ğ¸Ñ â€” 2 Ğ¼Ğ¸Ğ½\n"
    "â€¢ ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ â†’ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾: Â«Ğ¨Ğ»Ğ° Ğ¡Ğ°ÑˆĞ° Ğ¿Ğ¾ ÑˆĞ¾ÑÑĞµâ€¦Â». Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ¿Ğ°ÑƒĞ·Ñ‹ (|) Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ¼Ñ‹ÑĞ»Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ ĞºÑƒÑĞºĞ°Ğ¼Ğ¸."
)

LEVEL2_TEXT = (
    "Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 2 Â· 10 Ğ¼Ğ¸Ğ½\n\n"
    "Ğ”Ñ‹Ñ…Ğ°Ğ½Ğ¸Ğµ Ñ Ğ¾Ğ¿Ğ¾Ñ€Ğ¾Ğ¹ â€” 3 Ğ¼Ğ¸Ğ½\n"
    "â€¢ Ğ’Ğ´Ğ¾Ñ… Ğ²Ğ½Ğ¸Ğ· Ğ² Ğ±Ğ¾ĞºĞ°, Ğ²Ñ‹Ğ´Ğ¾Ñ… Ğ½Ğ° Â«Ñ„/ÑÂ», Ğ´ĞµÑ€Ğ¶Ğ¸ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ Ğ´Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ²ÑƒĞºĞ°.\n\n"
    "Ğ ĞµĞ·Ğ¾Ğ½Ğ°Ñ‚Ğ¾Ñ€Ñ‹ (Ğ¼-Ğ½-Ğ·) â€” 3 Ğ¼Ğ¸Ğ½\n"
    "â€¢ Ğ“ÑƒĞ´Ğ¸Ğ¼ Â«Ğ¼Â» Ğ½Ğ° 3â€“5 Ğ½Ğ¾Ñ‚ Ğ¿Ğ¾ Ğ³Ğ°Ğ¼Ğ¼Ğµ, Ğ¾Ñ‰ÑƒÑ‰Ğ°ĞµĞ¼ Ğ²Ğ¸Ğ±Ñ€Ğ°Ñ†Ğ¸Ñ Ğ² Ğ³ÑƒĞ±Ğ°Ñ…/Ğ½Ğ¾ÑĞµ/ÑĞºÑƒĞ»Ğµ.\n\n"
    "Ğ¢ĞµĞºÑÑ‚-Ñ€Ğ¸Ñ‚Ğ¼ â€” 4 Ğ¼Ğ¸Ğ½\n"
    "â€¢ ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ¹ Ğ°Ğ±Ğ·Ğ°Ñ†: 1) Ñ€Ğ¾Ğ²Ğ½Ğ¾, 2) Ñ Ğ¿Ğ°ÑƒĞ·Ğ°Ğ¼Ğ¸ Â«3-2-1Â», 3) Ñ Ğ°ĞºÑ†ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸ Ğ½Ğ° ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°."
)

LEVEL3_TEXT = (
    "Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 3 Â· 15 Ğ¼Ğ¸Ğ½ (ĞŸÑ€Ğ¾)\n\n"
    "Ğ ĞµĞ·Ğ¾Ğ½Ğ°Ñ‚Ğ¾Ñ€Ñ‹ â€” 5 Ğ¼Ğ¸Ğ½\n"
    "â€¢ Â«Ğ¼-Ğ½-Ğ½Ğ³Â» Ğ¿Ğ¾ Ğ½Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰ĞµĞ¹, Ğ¸Ñ‰ĞµĞ¼ Ğ¿Ğ¾Ğ»Ñ‘Ñ‚ Ğ±ĞµĞ· Ñ„Ğ¾Ñ€ÑĞ°Ğ¶Ğ°.\n"
    "â€¢ 3 ÑĞµÑ€Ğ¸Ğ¸ Â«Ğ±Ğ¸-Ğ±Ğµ-Ğ±Ğ°-Ğ±Ğ¾-Ğ±ÑƒÂ» Ğ½Ğ° Ğ»Ñ‘Ğ³ĞºĞ¾Ğ¹ Ğ¾Ğ¿Ğ¾Ñ€Ğµ, Ğ½Ğµ Ğ·Ğ°Ğ»Ğ¸Ğ¿Ğ°ĞµĞ¼ Ğ² Ğ³Ğ¾Ñ€Ğ»Ğµ.\n\n"
    "Ğ¢ĞµĞºÑÑ‚ Ñ Ğ¿Ğ°ÑƒĞ·Ğ°Ğ¼Ğ¸ â€” 5 Ğ¼Ğ¸Ğ½\n"
    "â€¢ Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ 6â€“8 Ñ„Ñ€Ğ°Ğ·. Ğ¡Ñ…ĞµĞ¼Ğ° Ğ¿Ğ°ÑƒĞ·: 2|1|3|1|2|3 (Ğ² ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ…). ĞĞ° Ğ¿Ğ°ÑƒĞ·Ğµ â€” Ğ²Ğ·Ğ³Ğ»ÑĞ´/Ğ¶ĞµÑÑ‚.\n\n"
    "ĞœĞ¸ĞºÑ€Ğ¾-ÑÑ‚ÑĞ´ â€” 5 Ğ¼Ğ¸Ğ½\n"
    "â€¢ Ğ¢ĞµĞ·Ğ¸Ñ (1 Ñ„Ñ€Ğ°Ğ·Ğ°) â†’ Ğ¼Ğ¸Ğ½Ğ¸-Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ (20â€“30 ÑĞµĞº) â†’ Ğ²Ñ‹Ğ²Ğ¾Ğ´ (1 Ñ„Ñ€Ğ°Ğ·Ğ°). "
    "Ğ¡Ğ½Ğ¸Ğ¼Ğ¸ 30â€“45 ÑĞµĞº, Ğ¾Ñ†ĞµĞ½Ğ¸: Ñ‚ĞµĞ¼Ğ¿, Ğ¿Ğ°ÑƒĞ·Ñ‹, Ğ°ĞºÑ†ĞµĞ½Ñ‚Ñ‹."
)

def _levels_kb() -> InlineKeyboardMarkup:
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 1", callback_data="tr:level:1")],
        [InlineKeyboardButton(text="Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 2", callback_data="tr:level:2")],
        [InlineKeyboardButton(text="Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 3", callback_data="tr:level:3")],
        [InlineKeyboardButton(text="ğŸ  Ğ’ Ğ¼ĞµĞ½Ñ", callback_data="go:menu")],
    ])

def _done_kb(level: str) -> InlineKeyboardMarkup:
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ğ»(Ğ°)", callback_data=f"tr:done:{level}")],
        [InlineKeyboardButton(text="ğŸ  Ğ’ Ğ¼ĞµĞ½Ñ", callback_data="go:menu")],
    ])

# â”€â”€ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ²Ñ…Ğ¾Ğ´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async def show_training_levels(message: Message, state: FSMContext):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ¸ Ğ² Ğ´Ğ¸Ğ¿Ğ»Ğ¸Ğ½ĞºĞµ)."""
    await state.clear()
    text = (
        "ğŸ‹ï¸ Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ´Ğ½Ñ\n\n"
        "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ â€” Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğµ ÑˆĞ°Ğ³Ğ¸. "
        "ĞšĞ¾Ğ³Ğ´Ğ° Ğ·Ğ°ĞºĞ¾Ğ½Ñ‡Ğ¸ÑˆÑŒ â€” Ğ¶Ğ¼Ğ¸ Â«âœ… Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ğ»(Ğ°)Â». "
        "Ğ¥Ğ¾Ñ‡ĞµÑˆÑŒ Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ â€” Â«ğŸ  Ğ’ Ğ¼ĞµĞ½ÑÂ»."
    )
    await message.answer(text, reply_markup=_levels_kb())

# ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ñ‹Ğ¹ Ğ°Ğ»Ğ¸Ğ°Ñ Ğ¿Ğ¾Ğ´ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹
training_entry = show_training_levels

__all__ = ["router", "show_training_levels", "training_entry"]

# â”€â”€ Ñ…ĞµĞ½Ğ´Ğ»ĞµÑ€Ñ‹ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹/Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@router.callback_query(F.data.startswith("tr:level:"))
async def training_show_level(cq: CallbackQuery):
    await cq.answer()
    level = cq.data.split(":")[-1]
    mapping = {"1": LEVEL1_TEXT, "2": LEVEL2_TEXT, "3": LEVEL3_TEXT}
    text = mapping.get(level, "ĞŸĞ»Ğ°Ğ½ ÑĞºĞ¾Ñ€Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ğ¼ ğŸ™‚")

    await cq.message.answer(text, reply_markup=_done_kb(level))

@router.callback_query(F.data.startswith("tr:done:"))
async def training_done(cq: CallbackQuery):
    await cq.answer("Ğ—Ğ°ÑÑ‡Ğ¸Ñ‚Ğ°Ğ½Ğ¾!")
    level = cq.data.split(":")[-1]

    # Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµĞ¼ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´, ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ğ²Ğ°ÑˆĞ° Ğ¾Ğ±Ñ‘Ñ€Ñ‚ĞºĞ°
    try:
        from app.storage.repo_extras import save_training_episode
        await save_training_episode(user_id=cq.from_user.id, level=level)
    except Exception:
        pass

    await cq.message.answer("ğŸ”¥ ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! Ğ”ĞµĞ½ÑŒ Ğ·Ğ°ÑÑ‡Ğ¸Ñ‚Ğ°Ğ½. Ğ£Ğ²Ğ¸Ğ´Ğ¸Ğ¼ÑÑ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°!")

    # ÑÑ€Ğ°Ğ·Ñƒ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ² Ğ¼ĞµĞ½Ñ Ñ‚ĞµĞ¼ Ğ¶Ğµ ÑĞ¿Ğ¾ÑĞ¾Ğ±Ğ¾Ğ¼, ĞºĞ°Ğº Ğ¿Ñ€Ğ¸ /start
    try:
        from app.routers.help import show_main_menu
        await show_main_menu(cq)
    except Exception:
        # ĞµÑĞ»Ğ¸ Ğ²Ğ´Ñ€ÑƒĞ³ Ñ‡Ñ‚Ğ¾-Ñ‚Ğ¾ Ğ½Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¾ÑÑŒ â€” Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ ĞºĞ½Ğ¾Ğ¿ĞºĞ° Ğ½Ğ°Ğ·Ğ°Ğ´ ÑƒĞ¶Ğµ ĞµÑÑ‚ÑŒ
        pass
