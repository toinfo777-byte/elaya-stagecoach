name: Daily status report

on:
  workflow_dispatch:
  schedule:
    - cron: "30 6 * * *"   # 09:30 MSK

jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - name: Send daily report to Telegram
        env:
          TG_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
          CHAT_ID:  ${{ secrets.TG_STATUS_CHAT_ID }}
          REPO:     ${{ github.repository }}
          RUN_ID:   ${{ github.run_id }}
          SHA:      ${{ github.sha }}
        run: |
          SHORT=$(echo "$SHA" | cut -c1-7)
          TEXT="⏰ Daily ok · ${REPO} · ${SHORT}\nhttps://github.com/${REPO}/actions/runs/${RUN_ID}"
          curl -sS -X POST "https://api.telegram.org/bot${TG_TOKEN}/sendMessage" \
            -d chat_id="${CHAT_ID}" \
            -d parse_mode="Markdown" \
            --data-urlencode text="$TEXT" >/dev/null
